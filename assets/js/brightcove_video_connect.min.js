define("models/media",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({sync:function(r,i,s){var o=null;t.find(wpbc.preload.accounts,function(e,t){if(e.account_id===this.get("account_id"))return o=t,!0},this);if(t.isUndefined(this.id))return e.Deferred().rejectWith(this).promise();if("read"===r)return s=s||{},s.context=this,s.data=t.extend(s.data||{},{action:"bc_media_fetch",id:this.id}),wp.media.ajax(s);if("update"===r){s=s||{},s.context=this,s.data=t.extend(s.data||{},{account:o,action:"bc_media_update",description:this.get("description"),long_description:this.get("long_description"),name:this.get("name"),nonce:wpbc.preload.nonce,tags:this.get("tags"),type:this.get("mediaType")});var u=this.get("video_ids");return u?(s.data.playlist_id=this.id,s.data.playlist_videos=u,s.data.type="playlists"):s.data.video_id=this.id,s.success=this.successFunction,s.error=this.failFunction,wpbc.broadcast.trigger("spinner:on"),wp.media.ajax(s)}return"delete"===r?(s=s||{},s.data=t.extend(s.data||{},{account:o,action:"bc_media_delete",id:this.get("id"),nonce:wpbc.preload.nonce,type:this.get("mediaType")}),wp.media.ajax(s).done(function(e){this.destroyed=!0,wpbc.broadcast.trigger("delete:successful",e),"videos"===this.get("mediaType")||!t.isUndefined(this.get("video_ids"))?wpbc.preload.videos=undefined:wpbc.preload.playlists=undefined,wpbc.responses={}}).fail(function(e){this.destroyed=!1,wpbc.broadcast.trigger("videoEdit:message",e,"error"),wpbc.broadcast.trigger("spinner:off")})):n.Model.prototype.sync.apply(this,arguments)},parse:function(e){return e?(e.date=new Date(e.date),e.modified=new Date(e.modified),e):e},getAccountName:function(){var e=this.get("account_id"),n=t.findWhere(wpbc.preload.accounts,{account_id:this.get("account_id")});return undefined===n?"unavailable":n.account_name},getReadableDuration:function(){var e=this.get("duration");if(e){e=Number(e/1e3);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(t>0?t+":"+(n<10?"0":""):"")+n+":"+(r<10?"0":"")+r}return e},getReadableDate:function(e){var t=this.get(e);if(t){var n=new Date(t),r=n.getHours(),i=n.getMinutes(),s=n.getFullYear(),o=n.getMonth()+1,u=n.getDate(),a=r>=12?"pm":"am";r%=12,r=r?r:12,i=i<10?"0"+i:i;var f=s+"/"+o+"/"+u+" - "+r+":"+i+" "+a;return f}return t},successFunction:function(e){wpbc.broadcast.trigger("videoEdit:message",e,"success"),wpbc.broadcast.trigger("spinner:off");if(t.isArray(this.get("video_ids"))&&wpbc.preload&&wpbc.preload.playlists){var n=this.get("id");t.each(wpbc.preload.playlists,function(e,t){e.id===n&&(wpbc.preload.playlists[t]=this.toJSON())},this)}wpbc.responses={},"videos"===this.get("mediaType")||!t.isUndefined(this.get("video_ids"))?wpbc.preload.videos=undefined:wpbc.preload.playlists=undefined},failFunction:function(e){wpbc.broadcast.trigger("videoEdit:message",e,"error"),wpbc.broadcast.trigger("spinner:off")}});return r}),define("models/media-collection",["models/media","jquery","underscore","backbone","wp"],function(e,t,n,r,i){var s=r.Collection.extend({model:e,initialize:function(e,t){t=t||{},t.activeAccount&&(this.activeAccount=t.activeAccount),this.additionalRequest=!1,this.pageNumber=this.pageNumber||1,!this.mediaType&&(this.mediaCollectionViewType==="existingPlaylists"||this.mediaCollectionViewType==="libraryPlaylists")&&(this.mediaType="videos"),this.mediaCollectionViewType=t.mediaCollectionViewType||"grid",t.excludeVideoIds&&"libraryPlaylists"===t.mediaCollectionViewType&&(this.excludeVideoIds=t.excludeVideoIds),t.videoIds&&!e?(this.mediaType="videos",this.videoIds=t.videoIds,this.fetch()):"playlists"!==t.mediaType&&(this.mediaType="videos",this.fetch()),this.mediaType=t.mediaType,"videos"===this.mediaType&&this.listenTo(wpbc.broadcast,"uploader:uploadedFileDetails",function(e){this.add(e,{at:0})}),this.activeAccount=t.activeAccount||"all",this.searchTerm=t.searchTerm||"",this.dates=t.dates||"all",this.tag=t.tag||"",this.listenTo(wpbc.broadcast,"change:activeAccount",function(e){this.activeAccount=e,this.fetch()}),this.listenTo(wpbc.broadcast,"change:searchTerm",function(e){this.searchTerm=e,this.fetch()}),this.listenTo(wpbc.broadcast,"change:tag",function(e){"all"===e&&(e=""),this.tag=e,this.fetch()}),this.listenTo(wpbc.broadcast,"change:date",function(e){this.date=e,this.fetch()}),this.listenTo(wpbc.broadcast,"tabChange",function(e){this.killPendingRequests();if(e.mediaType!==this.mediaType){this.mediaType=e.mediaType;var t=wpbc.preload[this.mediaType],n;while(n=this.first())this.remove(n);t!==undefined?this.add(t):this.fetch()}})},killPendingRequests:function(){n.each(wpbc.requests,function(e){e.abort()}),wpbc.requests=[]},checksum:function(e){n.isString(e)||(n.isFunction(e.toJSON)?e=e.toJSON():e=JSON.stringify(e));var t=305419896;for(var r=0;r<e.length;r++)t+=e.charCodeAt(r)*(r+1);return t},sync:function(e,o,u){var a,f;if("read"===e){u=u||{},u.data=n.extend(u.data||{},{action:"bc_media_query",account:this.activeAccount,dates:this.date,posts_per_page:100,page_number:this.pageNumber,nonce:wpbc.preload.nonce,search:this.searchTerm,tags:this.tag,tagName:wpbc.preload.tags[this.tag],type:this.mediaType||"videos"});var l=n.pick(u.data,"account","dates","posts_per_page","search","tags","type");this.additionalRequest=n.isEqual(l,wpbc.previousRequest),this.additionalRequest||(u.data.page_number=1),this.mediaCollectionViewType!=="existingPlaylists"&&(wpbc.previousRequest=l),this.videoIds&&(u.data.videoIds=this.videoIds.length?this.videoIds:"none"),u.data.query=a,n.contains(["libraryPlaylists","existingPlaylists"],this.mediaCollectionViewType)||this.killPendingRequests();var c=this.checksum(u.data);if(!n.isUndefined(wpbc.responses[c]))return this.parse({data:wpbc.responses[c]},"cached"),!0;var h=t.ajax({type:"POST",url:i.ajax.settings.url,context:this,data:u.data}).done(function(e,t,n){this.parse(e,t,n,c)}).fail(this.fetchFail);return wpbc.requests.push(h),wpbc.broadcast.trigger("spinner:on"),h}return f=s.prototype.sync?s.prototype:r,f.sync.apply(this,arguments)},fetchFail:function(){this.pageNumber>1&&this.pageNumber--,wpbc.broadcast.trigger("fetch:finished");if("abort"===status)return},parse:function(e,t,i,s){wpbc.broadcast.trigger("fetch:finished"),wpbc.broadcast.trigger("spinner:off");if(!n.contains(["success","cached"],t))return!1;var o=e.data;"success"===t&&(wpbc.responses[s]=o);if(!1===o)return!1;n.isArray(o)||(o=[o]),n.isArray(this.excludeVideoIds)&&n.each(this.excludeVideoIds,function(e){o=n.without(o,n.findWhere(o,{id:e}))});var u=n.map(o,function(e){var t,i,s;return e instanceof r.Model?(t=e.get("id"),e=e.attributes):t=e.id,i=this.findWhere({id:t}),i?(s=i.parse(e),n.isEqual(i.attributes,s)||i.set(s)):i=this.add(e),i.set("viewType",this.mediaCollectionViewType),i},this);this.additionalRequest?this.add(u):this.set(u)}});return s}),define("views/brightcove",["jquery","underscore","backbone","wp"],function(e,t,n,r){var i=r.Backbone.View.extend({subviews:null,registerSubview:function(e){this.subviews=this.subviews||[],this.subviews.push(e)},remove:function(){t.invoke(this.subviews,"remove"),r.Backbone.View.prototype.remove.call(this)},insertShortcode:function(){if(!this.model)return;var e=this.model.get("id").replace(/\D/g,""),t=this.model.get("account_id").replace(/\D/g,""),n="";this.mediaType==="videos"||!this.model.get("video_ids")?n='[bc_video video_id="'+e+'" account_id="'+t+'" player_id="default"]':n='[bc_playlist playlist_id="'+e+'" account_id="'+t+'"]',window.send_to_editor(n),wpbc.broadcast.trigger("close:modal")}});return i}),define("views/media",["wp","wpbc","underscore","jquery","views/brightcove"],function(e,t,n,r,i){var s=i.extend({tagName:"li",className:"attachment brightcove",attributes:function(){return{tabIndex:0,role:"checkbox","aria-label":this.model.get("title"),"aria-checked":!1,"data-id":this.model.get("id")}},events:{"click .attachment-preview":"toggleDetailView","click .video-move-up":"videoMoveUp","click .video-move-down":"videoMoveDown","click .trash":"removeVideoFromPlaylist","click .add-to-playlist":"videoAdd","click .edit":"triggerEditMedia","click .preview":"triggerPreviewMedia"},triggerEditMedia:function(e){e.preventDefault(),t.broadcast.trigger("edit:media",this.model)},triggerPreviewMedia:function(e){e.preventDefault(),t.broadcast.trigger("preview:media",this.model)},buttons:{},initialize:function(e){e=e||{},this.type=e.type?e.type:"grid",this.listenTo(this.model,"change:view",function(e,t){this.type!==t&&(this.type=t,this.render())}),this.render()},render:function(){var t=this.model.toJSON();return t.duration=this.model.getReadableDuration(),t.updated_at_readable=this.model.getReadableDate("updated_at"),t.account_name=this.model.getAccountName(),"existingPlaylists"===t.viewType?this.template=e.template("brightcove-playlist-edit-video-in-playlist"):"libraryPlaylists"===t.viewType?this.template=e.template("brightcove-playlist-edit-video-in-library"):this.template=e.template("brightcove-media-item-"+this.type),t.buttons=this.buttons,this.$el.html(this.template(t)),this.$el.toggleClass("uploading",t.uploading),this},toggleDetailView:function(){t.broadcast.trigger("view:toggled",this)},videoMoveUp:function(){t.broadcast.trigger("playlist:moveUp",this)},videoMoveDown:function(){t.broadcast.trigger("playlist:moveDown",this)},videoAdd:function(){t.broadcast.trigger("playlist:add",this)},removeVideoFromPlaylist:function(){t.broadcast.trigger("playlist:remove",this)}});return s}),define("views/media-collection",["jquery","underscore","backbone","views/media","views/brightcove","models/media-collection"],function(e,t,n,r,i,s){var o=i.extend({tagName:"ul",className:"brightcove-media attachments",attributes:{tabIndex:-1},events:{scroll:"scrollHandler"},loadMoreMediaItems:function(){this.fetchingResults=!0,this.collection.fetch()},scrollHandler:function(){if("existingPlaylists"===this.collection.mediaCollectionViewType)return;var e=200;!this.fetchingResults&&this.el.scrollTop+this.el.clientHeight+e>this.el.scrollHeight&&(this.collection.pageNumber+=1,this.loadMoreMediaItems())},initialize:function(n){this.fetchingResults=!1,this.listenTo(wpbc.broadcast,"fetch:finished",function(){this.fetchingResults=!1});var r=wp.media.isTouchDevice?300:200;this.scrollHandler=t.chain(this.scrollHandler).bind(this).throttle(r).value(),this.listenTo(wpbc.broadcast,"scroll:mediaGrid",this.scrollHandler),n=n||{},this.el.id=t.uniqueId("__attachments-view-"),!this.collection&&n.videoIds?(this.collection=new s(null,{videoIds:n.videoIds,activeAccount:n.activeAccount,mediaCollectionViewType:n.mediaCollectionViewType}),this.listenTo(wpbc.broadcast,"playlist:moveUp",this.videoMoveUp),this.listenTo(wpbc.broadcast,"playlist:moveDown",this.videoMoveDown),this.listenTo(wpbc.broadcast,"playlist:remove",this.videoRemove),this.listenTo(wpbc.broadcast,"playlist:add",this.videoAdd)):!this.collection&&"libraryPlaylists"===n.mediaCollectionViewType&&(this.collection=new s(null,{excludeVideoIds:n.excludeVideoIds,activeAccount:n.activeAccount,mediaCollectionViewType:n.mediaCollectionViewType}),this.listenTo(wpbc.broadcast,"playlist:remove",this.videoRemove),this.listenTo(wpbc.broadcast,"playlist:add",this.videoAdd)),t.defaults(this.options,{refreshSensitivity:wp.media.isTouchDevice?300:200,refreshThreshold:3,VideoView:wp.media.view.Video,sortable:!1,resize:!0,idealColumnWidth:202}),this._viewsByCid={},this.resizeEvent="resize.media-modal-columns",this.listenTo(this.collection,"add",function(e){this.views.add(this.createMediaView(e),{at:this.collection.indexOf(e)})},this),this.listenTo(this.collection,"remove",function(e){e&&(e.view?e.view.remove():e.cid&&this._viewsByCid[e.cid]&&this._viewsByCid[e.cid].remove())},this),this.listenTo(this.collection,"reset",this.render),this.scroll=t.chain(this.scroll).bind(this).throttle(this.options.refreshSensitivity).value(),this.options.scrollElement=this.options.scrollElement||this.el,e(this.options.scrollElement).on("scroll",this.scroll),t.bindAll(this,"setColumns"),this.options.resize&&(this.on("ready",this.bindEvents),t.defer(this.setColumns,this))},render:function(){this.$el.empty(),this.collection.each(function(e){e.view=new r({model:e}),this.registerSubview(e.view),e.view.render(),e.view.delegateEvents(),e.view.$el.appendTo(this.$el)},this)},setViewType:function(e){this.collection.each(function(t){t.set("view",e)},this)},bindEvents:function(){this.$window.off(this.resizeEvent).on(this.resizeEvent,t.debounce(this.setColumns,50))},setColumns:function(){var e=this.columns,t=this.$el.width();t&&(this.columns=Math.min(Math.round(t/this.options.idealColumnWidth),12)||1,(!e||e!==this.columns)&&this.$el.closest(".media-frame-content").attr("data-columns",this.columns))},createMediaView:function(e){e.set("viewType",this.collection.mediaCollectionViewType);var t=new r({controller:this.controller,model:e,collection:this.collection,selection:this.options.selection});return this.registerSubview(t),this._viewsByCid[e.cid]=t,t},prepare:function(){this.collection.length?this.views.set(this.collection.map(this.createMediaView,this)):(this.views.unset(),this.collection.more().done(this.scroll))},ready:function(){this.scroll()},scroll:function(){var t=this,n=this.options.scrollElement,r=n.scrollTop,i;n===document&&(n=document.body,r=e(document).scrollTop());if("function"!==this.collection.hasMore||!e(n).is(":visible")||!this.collection.hasMore())return;i=this.views.parent.toolbar,n.scrollHeight-(r+n.clientHeight)<n.clientHeight/3&&i.get("spinner").show(),n.scrollHeight<r+n.clientHeight*this.options.refreshThreshold&&this.collection.more().done(function(){t.scroll(),i.get("spinner").hide()})},videoMoveUp:function(e){var t=e.model,n=this.collection.indexOf(t);n>0&&(this.collection.remove(t,{silent:!0}),this.collection.add(t,{at:n-1})),this.render(),this.playlistChanged()},videoMoveDown:function(e){var t=e.model,n=this.collection.indexOf(t);n<this.collection.models.length&&(this.collection.remove(t,{silent:!0}),this.collection.add(t,{at:n+1})),this.render(),this.playlistChanged()},videoRemove:function(e){var t=e.model;-1===this.collection.indexOf(t)?this.collection.add(t):(this.collection.remove(t,{silent:!0}),this.playlistChanged()),this.render()},videoAdd:function(e){var t=e.model;-1===this.collection.indexOf(t)?(this.collection.add(t),this.playlistChanged()):(this.collection.remove(t,{silent:!0}),this.render())},playlistChanged:function(){var e=[];this.collection.each(function(t){e.push(t.id)}),this.videoIds=e,this.syncPlaylist()},syncPlaylist:function(){wpbc.broadcast.trigger("playlist:changed",this.videoIds)}});return o}),define("models/brightcove-media-manager",["jquery","underscore","backbone","models/media-collection","views/media-collection"],function(e,t,n,r,i){var s=n.Model.extend({defaults:{view:"grid",date:"all",tags:"all",type:null,preload:!0,search:"",account:"all"},initialize:function(e){t.defaults(e,this.defaults);var n=new r([],{mediaType:e.mediaType});n.reset(),e.preload&&e.preload.length&&n.add(e.preload),e.preload=!!e.preload,this.set("media-collection-view",new i({collection:n})),this.set("options",e)}});return s}),define("views/video-preview",["jquery","underscore","backbone","views/brightcove-media-manager","views/brightcove"],function(e,t,n,r,i){var s=i.extend({tagName:"div",className:"video-preview brightcove",template:wp.template("brightcove-video-preview"),render:function(e){e=e||{},e.id=this.model.get("id"),e.account_id=this.model.get("account_id"),this.$el.html(this.template(e)),this.listenTo(wpbc.broadcast,"insert:shortcode",this.insertShortcode)}});return s}),define("views/video-edit",["jquery","underscore","backbone","views/brightcove-media-manager","views/video-preview","views/brightcove"],function(e,t,n,r,i,s){var o=s.extend({tagName:"div",className:"video-edit brightcove attachment-details",template:wp.template("brightcove-video-edit"),events:{"click .brightcove.button.save-sync":"saveSync","click .brightcove.delete":"deleteVideo","click .brightcove.button.back":"back"},back:function(e){e.preventDefault(),wpbc.broadcast.trigger("start:gridview")},deleteVideo:function(){confirm(wpbc.preload.messages.confirmDelete)&&(wpbc.broadcast.trigger("spinner:on"),this.model.set("mediaType","videos"),this.model.destroy())},saveSync:function(){wpbc.broadcast.trigger("spinner:on"),this.model.set("name",this.$el.find(".brightcove-name").val()),this.model.set("description",this.$el.find(".brightcove-description").val()),this.model.set("long_description",this.$el.find(".brightcove-long-description").val()),this.model.set("tags",this.$el.find(".brightcove-tags").val()),this.model.set("mediaType","videos"),this.model.save()},render:function(e){this.listenTo(wpbc.broadcast,"insert:shortcode",this.insertShortcode),e=this.model.toJSON(),this.$el.html(this.template(e));var t=this.$el.find(".spinner");this.listenTo(wpbc.broadcast,"spinner:on",function(){t.addClass("is-active").removeClass("hidden")}),this.listenTo(wpbc.broadcast,"spinner:off",function(){t.removeClass("is-active").addClass("hidden")})}});return o}),define("views/playlist-edit-video",["jquery","underscore","backbone","models/media","views/brightcove"],function(e,t,n,r,i){var s=i.extend({tagName:"div",className:"",template:wp.template("brightcove-playlist-edit"),events:{"click .brightcove.button.save-sync":"saveSync","click .brightcove.back":"back"},render:function(e){e=this.model.toJSON(),this.$el.html(this.template(e))}});return s}),define("views/playlist-edit",["jquery","underscore","backbone","views/brightcove-media-manager","views/playlist-edit-video","views/brightcove","views/media-collection"],function(e,t,n,r,i,s,o){var u=s.extend({tagName:"div",className:"playlist-edit brightcove attachment-details",template:wp.template("brightcove-playlist-edit"),events:{"click .brightcove.button.save-sync":"saveSync","click .brightcove.back":"back","change .brightcove-name":"updatedName"},deleteVideo:function(e){e.preventDefault(),this.model.set("mediaType","videos"),this.model.destroy()},updatedName:function(e){var t=this.model.get("name");t!==e.target.value&&(this.model.set("name",e.target.value),this.model.save())},back:function(e){e.preventDefault(),wpbc.broadcast.trigger("start:gridview")},saveSync:function(e){e.preventDefault(),this.model.set("name",this.$el.find(".brightcove-name").val()),this.model.set("description",this.$el.find(".brightcove-description").val()),this.model.set("long_description",this.$el.find(".brightcove-long-description").val()),this.model.set("tags",this.$el.find(".brightcove-tags").val()),this.model.set("mediaType","videos"),this.model.save()},initialize:function(){this.listenTo(wpbc.broadcast,"tabChange",function(){t.invoke(this.subviews,"remove")}),wpbc.broadcast.trigger("spinner:off")},render:function(e){e=this.model.toJSON(),this.$el.html(this.template(e)),this.spinner=this.$el.find(".spinner");var n=this.$el.find(".existing-videos");e.video_ids&&(this.killPendingRequests(),this.playlistVideosView=new o({el:this.$el.find(".existing-videos"),videoIds:e.video_ids,activeAccount:this.model.get("account_id"),mediaCollectionViewType:"existingPlaylists",mediaType:"playlists"}),this.libraryVideosView=new o({el:this.$el.find(".library-videos"),excludeVideoIds:e.video_ids,activeAccount:this.model.get("account_id"),mediaCollectionViewType:"libraryPlaylists",mediaType:"playlists"}),this.registerSubview(this.playlistVideosView),this.registerSubview(this.libraryVideosView),this.listenTo(wpbc.broadcast,"playlist:changed",t.throttle(this.playlistChanged,300)),this.listenTo(wpbc.broadcast,"insert:shortcode",this.insertShortcode)),this.listenTo(wpbc.broadcast,"spinner:on",function(){this.spinner.addClass("is-active").removeClass("hidden")}),this.listenTo(wpbc.broadcast,"spinner:off",function(){this.spinner.removeClass("is-active").addClass("hidden")})},playlistChanged:function(e){this.killPendingRequests(),this.model.set("video_ids",e),this.model.save()},killPendingRequests:function(){t.each(wpbc.requests,function(e){e.abort()}),wpbc.requests=[]}});return u}),define("views/toolbar",["jquery","underscore","backbone","views/brightcove"],function(e,t,n,r){var i=r.extend({tagName:"div",className:"media-toolbar wp-filter",template:wp.template("brightcove-media-toolbar"),events:{"click .view-list":"toggleList","click .view-grid":"toggleGrid","change .brightcove-media-source":"sourceChanged","change .brightcove-media-dates":"datesChanged","change .brightcove-media-tags":"tagsChanged","change .brightcove-empty-playlists":"emptyPlaylistsChanged","keyup .search":"searchHandler"},render:function(){var e=this.model.get("mediaType"),t={accounts:wpbc.preload.accounts,dates:{},mediaType:e,tags:wpbc.preload.tags},n=wpbc.preload.dates,r=this.model.get("date");n!==undefined&&n[e]!==undefined&&n[e][r]!==undefined&&(t.dates=n[e][r]),this.$el.html(this.template(t));var i=this.$el.find(".spinner");this.listenTo(wpbc.broadcast,"spinner:on",function(){i.addClass("is-active").removeClass("hidden")}),this.listenTo(wpbc.broadcast,"spinner:off",function(){i.removeClass("is-active").addClass("hidden")})},toggleList:function(){this.trigger("viewType","list"),this.$el.find(".view-list").addClass("current"),this.$el.find(".view-grid").removeClass("current")},toggleGrid:function(){this.trigger("viewType","grid"),this.$el.find(".view-grid").addClass("current"),this.$el.find(".view-list").removeClass("current")},sourceChanged:function(e){wpbc.broadcast.trigger("change:activeAccount",e.target.value)},datesChanged:function(e){wpbc.broadcast.trigger("change:date",e.target.value)},tagsChanged:function(e){wpbc.broadcast.trigger("change:tag",e.target.value)},emptyPlaylistsChanged:function(t){var n=e(t.target).prop("checked");wpbc.broadcast.trigger("change:emptyPlaylists",n)},searchHandler:function(e){e.keyCode===13&&(this.model.set("search",e.target.value),wpbc.broadcast.trigger("change:searchTerm",e.target.value))}});return i}),define("views/media-details",["wp","wpbc","underscore","jquery","views/brightcove"],function(e,t,n,r,i){var s=i.extend({tagName:"div",className:"media-details",attributes:function(){return{tabIndex:0,role:"checkbox","aria-label":this.model.get("title"),"aria-checked":!1,"data-id":this.model.get("id")}},events:{"click .brightcove.edit.button":"triggerEditMedia","click .brightcove.preview.button":"triggerPreviewMedia","click .brightcove.back.button":"backButton"},triggerEditMedia:function(e){e.preventDefault(),t.broadcast.trigger("edit:media",this.model)},triggerPreviewMedia:function(e){e.preventDefault(),t.broadcast.trigger("preview:media",this.model)},backButton:function(e){t.broadcast.trigger("backButton",this.mediaType)},initialize:function(e){e=e||{},this.type=e.type?e.type:"grid",this.mediaType=e.mediaType,this.listenTo(t.broadcast,"insert:shortcode",this.insertShortcode),this.listenTo(this.model,"change",this.render)},render:function(t){return t=n.extend({},t,this.model.toJSON()),t.duration=this.model.getReadableDuration(),t.updated_at_readable=this.model.getReadableDate("updated_at"),t.created_at_readable=this.model.getReadableDate("created_at"),t.account_name=this.model.getAccountName(),this.template=e.template("brightcove-media-item-details-"+this.mediaType),this.$el.html(this.template(t)),this.delegateEvents(),this},remove:function(){return this.undelegateEvents(),this.$el.empty(),this.stopListening(),this}});return s}),define("models/upload",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({initialize:function(e){},humanReadableSize:function(){var e=this.get("size");if(e===0)return"0 Byte";var t=1e3,n=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,r)).toPrecision(3)+" "+n[r]}});return r}),define("models/upload-collection",["jquery","underscore","backbone","models/upload"],function(e,t,n,r){var i=n.Collection.extend({initialize:function(e){this.listenTo(wpbc.broadcast,"uploader:queuedFilesAdded",this.queuedFilesAdded)},queuedFilesAdded:function(e){t.each(e,function(e){this.add(new r(e))},this)}});return i}),define("views/upload",["jquery","underscore","backbone","wp","wpbc","views/brightcove"],function(e,t,n,r,i,s){return s.extend({className:"brightcove-pending-upload",tagName:"tr",template:r.template("brightcove-pending-upload"),events:{click:"toggleRow"},initialize:function(){this.listenTo(i.broadcast,"pendingUpload:selectedRow",this.otherToggledRow),this.listenTo(i.broadcast,"uploader:uploadProgress",this.uploadProgress),this.listenTo(i.broadcast,"uploader:getParams",this.getParams),this.listenTo(i.broadcast,"uploader:successfulUploadIngest",this.successfulUploadIngest),this.listenTo(i.broadcast,"uploader:failedUploadIngest",this.failedUploadIngest);var e={fileName:this.model.get("name"),tags:"",accounts:i.preload.accounts,account:i.preload.defaultAccount,ingestSuccess:!1,uploadSuccess:!1,uploaded:!1};this.model.set(e),this.listenTo(this.model,"change:fileName",this.render),this.listenTo(this.model,"change:account",this.render)},render:function(e){e=e||{},e.fileName=this.model.get("fileName"),e.size=this.model.humanReadableSize();var t=this.model.get("account");e.accountName=i.preload.accounts[t].account_name,e.percent=this.model.get("percent"),e.activeUpload=this.model.get("activeUpload"),e.ingestSuccess=this.model.get("ingestSuccess"),e.uploadSuccess=this.model.get("uploadSuccess"),this.$el.html(this.template(e)),this.model.get("selected")&&this.$el.addClass("selected"),this.model.get("ingestSuccess")&&this.$el.addClass("ingest-success"),this.model.get("uploadSuccess")&&this.$el.addClass("upload-success")},getParams:function(e){i.broadcast.trigger("uploader:params","abcde")},failedUploadIngest:function(e){e.id===this.model.get("id")&&(i.broadcast.trigger("uploader:errorMessage",i.preload.messages.unableToUpload.replace("%%s%%",this.model.get("fileName"))),this.render())},successfulUploadIngest:function(e){e.id===this.model.get("id")&&(i.broadcast.trigger("uploader:successMessage",i.preload.messages.successUpload.replace("%%s%%",this.model.get("fileName"))),this.render())},uploadProgress:function(e){e.id===this.model.get("id")?(this.model.set("activeUpload",!0),this.model.set("percent",e.percent),this.render()):this.model.get("activeUpload")&&(this.model.unset("activeUpload"),this.render())},toggleRow:function(e){this.$el.toggleClass("selected"),this.$el.hasClass("selected")?(this.model.set("selected",!0),i.broadcast.trigger("pendingUpload:selectedRow",this.cid)):i.broadcast.trigger("pendingUpload:hideDetails",this.cid)},otherToggledRow:function(e){e!==this.cid?(this.$el.removeClass("selected"),this.model.unset("selected")):i.broadcast.trigger("pendingUpload:selectedItem",this.model)}})}),define("views/upload-window",["jquery","underscore","backbone","plupload","wp","wpbc","views/brightcove"],function(e,t,n,r,i,s,o){return o.extend({className:"uploader-window",template:i.template("brightcove-uploader-window"),initialize:function(e){t.bindAll(this,"uploaderFilesAdded"),this.listenTo(s.broadcast,"uploader:queuedFilesAdded",this.hide),this.listenTo(s.broadcast,"uploader:startUpload",this.uploaderStartUpload),this.listenTo(s.broadcast,"uploader:clear",this.resetUploads)},render:function(e){this.$el.html(this.template(e)),t.defer(t.bind(this.afterRender,this))},resetUploads:function(){this.uploader&&this.uploader.files&&(this.uploader.files=[])},afterRender:function(){this.uploader=new plupload.Uploader(t.defaults(this.options,s.preload.plupload)),this.uploader.added=this.uploaderFilesAdded,this.uploader.progress=this.uploaderUploadProgress,this.uploader.bind("FilesAdded",this.uploaderFilesAdded),this.uploader.bind("UploadProgress",this.uploaderUploadProgress),this.uploader.bind("BeforeUpload",this.uploaderBeforeUpload),this.uploader.bind("FileUploaded",this.uploaderFileUploaded),this.uploader.bind("init",this.uploaderAfterInit),this.uploader.init(),e("html").on("dragenter",t.bind(this.show,this));var n=s.preload.plupload.drop_element.replace(/[^a-zA-Z0-9-]+/g,""),r=e("#"+n);r.on("dropzone:leave",t.bind(this.hide,this))},uploaderAfterInit:function(t){var n=s.preload.plupload.drop_element.replace(/[^a-zA-Z0-9-]+/g,""),r,i,o,u=e("#"+n);o=t.features.dragdrop;if(!u)return;u.toggleClass("supports-drag-drop",!!o);if(!o)return u.unbind(".wp-uploader");u.bind("dragover.wp-uploader",function(){r&&clearTimeout(r);if(i)return;u.trigger("dropzone:enter").addClass("drag-over"),i=!0}),u.bind("dragleave.wp-uploader, drop.wp-uploader",function(){r=setTimeout(function(){i=!1,u.trigger("dropzone:leave").removeClass("drag-over")},0)})},show:function(){var e=this.$el.show();t.defer(function(){e.css({opacity:1})})},hide:function(){var e=this.$el.css({opacity:0});i.media.transition(e).done(function(){"0"===e.css("opacity")&&e.hide()}),t.delay(function(){"0"===e.css("opacity")&&e.is(":visible")&&e.hide()},500)},uploaderFilesAdded:function(e,t){s.broadcast.trigger("uploader:queuedFilesAdded",t)},uploaderStartUpload:function(){this.uploader.start()},uploaderUploadProgress:function(e,t){s.broadcast.trigger("uploader:uploadProgress",t)},uploaderBeforeUpload:function(e,n){e.settings.multipart_params=t.defaults(s.uploads[n.id],s.preload.plupload.multipart_params,{nonce:s.preload.nonce})},uploaderFileUploaded:function(e,t,n){var r=JSON.parse(n.response);s.broadcast.trigger("uploader:fileUploaded",t),r.data.upload==="success"&&r.data.ingest==="success"?(r.data.videoDetails&&(s.broadcast.trigger("uploader:uploadedFileDetails",r.data.videoDetails),s.preload.videos.unshift(r.data.videoDetails)),s.broadcast.trigger("uploader:successfulUploadIngest",t)):(t.percent=0,t.status=plupload.UPLOADING,e.state=plupload.STARTED,e.trigger("StateChanged"),s.broadcast.trigger("uploader:failedUploadIngest",t))}})}),define("views/upload-details",["jquery","underscore","backbone","wp","wpbc","views/brightcove"],function(e,t,n,r,i,s){return s.extend({className:"brightcove-pending-upload-details attachment-details",tagName:"div",template:r.template("brightcove-pending-upload-details"),events:{"keyup .brightcove-name":"nameChanged","keyup .brightcove-tags":"tagsChanged","change .brightcove-media-source":"accountChanged"},initialize:function(e){this.listenTo(i.broadcast,"pendingUpload:hideDetails",this.hide),this.listenTo(i.broadcast,"uploader:fileUploaded",function(e){e.id===this.model.get("id")&&(this.model.set("uploaded",!0),this.render())}),this.model.set("ingestSuccess",!0),this.model.set("uploadSuccess",!0)},nameChanged:function(e){this.model.set("fileName",e.target.value)},tagsChanged:function(e){this.model.set("tags",e.target.value)},accountChanged:function(e){this.model.set("account",e.target.value)},hide:function(){this.$el.hide()},render:function(e){e=e||{},e.fileName=this.model.get("fileName"),e.tags=this.model.get("tags"),e.size=this.model.humanReadableSize(),e.accounts=this.model.get("accounts"),e.account=this.model.get("account"),e.uploaded=this.model.get("uploaded"),this.$el.html(this.template(e))}})}),define("views/upload-video-manager",["jquery","underscore","backbone","models/upload-collection","views/upload","wp","wpbc","views/upload-window","views/upload-details","views/brightcove"],function(e,t,n,r,i,s,o,u,a,f){return f.extend({className:"brightcove-file-uploader",events:{"click .brightcove-start-upload":"triggerUpload"},initialize:function(e){this.collection=new r,e&&(this.options=e,this.successMessage=e.successMessage||this.successMessage),this.uploadWindow=new u,this.listenTo(this.collection,"add",this.fileAdded),this.listenTo(o.broadcast,"pendingUpload:selectedItem",this.selectedItem),this.listenTo(o.broadcast,"uploader:prepareUpload",this.prepareUpload),this.listenTo(o.broadcast,"uploader:successMessage",this.successMessage),this.listenTo(o.broadcast,"uploader:errorMessage",this.errorMessage),this.listenTo(o.broadcast,"uploader:clear",this.resetUploads)},resetUploads:function(){while(model=this.collection.first())this.collection.remove(model)},errorMessage:function(e){this.message(e,"error")},successMessage:function(e){this.message(e,"success")},message:function(t,n){var r=this.$el.find(".brightcove-messages"),i="brightcove-message ";"success"===n?i+="notice updated":"error"===n&&(i+="error");var s=e('<div class="wrap"><div class="'+i+'"><p>'+t+"</p></div></div>");r.append(s),s.fadeOut(6e3,function(){e(this).remove()})},prepareUpload:function(){o.uploads=o.uploads||{},this.collection.each(function(e){o.uploads[e.get("id")]={account:e.get("account"),name:e.get("fileName"),tags:e.get("tags")}}),o.broadcast.trigger("uploader:startUpload")},fileAdded:function(e,t){this.collection.length===1&&this.render();var n=new i({model:e});n.render(),n.$el.appendTo(this.$el.find(".brightcove-pending-uploads"))},triggerUpload:function(){o.broadcast.trigger("uploader:prepareUpload")},selectedItem:function(e){this.uploadDetails=new a({model:e}),this.uploadDetails.render(),this.$el.find(".brightcove-pending-upload-details").remove(),this.uploadDetails.$el.appendTo(this.$el.find(".brightcove-upload-queued-files"))},render:function(t){this.collection.length?this.template=s.template("brightcove-uploader-queued-files"):(this.template=s.template("brightcove-uploader-inline"),this.uploadWindow.render(),this.uploadWindow.$el.appendTo(e("body"))),this.$el.html(this.template(t)),this.collection.length?this.$el.find(".brightcove-start-upload").show():this.$el.find(".brightcove-start-upload").hide()}})}),define("views/brightcove-media-manager",["jquery","underscore","backbone","models/brightcove-media-manager","views/video-edit","views/playlist-edit","views/toolbar","views/media-details","views/video-preview","wpbc","views/upload-video-manager","views/brightcove"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=c.extend({tagName:"div",className:"brightcove-media",events:{},scrollHandler:function(){f.broadcast.trigger("scroll:mediaGrid")},initialize:function(n){var c=wp.media.isTouchDevice?300:200;this.scrollHandler=t.chain(this.scrollHandler).bind(this).throttle(c).value(),this.options=n,this.mode=n.mode||"manager",n.preload=this.options.preload?f.preload[this.options.mediaType]:!1,this.model=new r(n),this.toolbar=new o({model:this.model}),this.uploader=new l,this.model.set("accounts",f.preload.accounts),this.model.set("activeAccount",n.account),this.listenTo(this.toolbar,"viewType",function(e){this.model.set("view",e)}),this.listenTo(f.broadcast,"videoEdit:message",this.message),this.listenTo(f.broadcast,"permanent:message",this.permanentMessage),this.listenTo(f.broadcast,"remove:permanentMessage",function(){f.permanentMessage&&f.permanentMessage.remove(),this.$el.find(".brightcove-message").addClass("hidden")}),this.listenTo(this.model,"change:view",function(e,t){this.model.get("media-collection-view").setViewType(t)}),this.listenTo(this.model,"change:mode",function(e,t){"uploader"!==t&&f.broadcast.trigger("uploader:clear")}),this.listenTo(f.broadcast,"backButton",function(e){this.model.set("mode","manager"),this.render()}),this.listenTo(f.broadcast,"change:emptyPlaylists",function(e){var n=this.model.get("media-collection-view");t.each(n.collection.models,function(t){!t.get("video_ids").length&&t&&t.view&&t.view.$el&&(e?t.view.$el.hide():t.view.$el.show())})}),this.listenTo(f.broadcast,"delete:successful",function(e){this.startGridView(),this.message(e,"success")}),this.listenTo(f.broadcast,"change:activeAccount",function(e){this.clearPreview(),this.model.set("activeAccount",e)}),this.listenTo(f.broadcast,"change:tag",function(e){this.clearPreview(),this.model.set("tag",e)}),this.listenTo(f.broadcast,"change:date",function(e){this.clearPreview(),this.model.set("date",e)}),this.listenTo(f.broadcast,"upload:video",function(){this.showUploader()}),this.listenTo(this.model,"change:search",function(e,t){this.model.get("search")}),this.listenTo(f.broadcast,"start:gridview",function(){t.invoke(this.subviews,"remove"),this.detailsView=null,this.startGridView()}),this.listenTo(f.broadcast,"tabChange",function(e){this.model.set(e),this.detailsView instanceof u&&(this.detailsView.remove(),this.detailsView=undefined),this.render()}),this.listenTo(f.broadcast,"edit:media",function(e){var t=this.model.get("mediaType");if(t==="videos"){if("editVideo"===this.model.get("mode"))return!0;this.editView=new i({model:e}),this.registerSubview(this.editView),this.model.set("mode","editVideo"),this.render()}else{if("editPlaylist"===this.model.get("mode"))return!0;this.editView=new s({model:e}),this.registerSubview(this.editView),this.model.set("mode","editPlaylist"),this.render()}}),this.listenTo(f.broadcast,"preview:media",function(e){var t=this.model.get("mediaType");if(t==="videos"){if("previewVideo"===this.model.get("mode"))return!0;this.previewView=new a({model:e}),this.registerSubview(this.previewView),this.model.set("mode","previewVideo"),this.render()}else this.model.set("mode","editPlaylist")}),this.listenTo(f.broadcast,"change:searchTerm",function(e){this.clearPreview()}),this.listenTo(f.broadcast,"view:toggled",function(t){this.detailsView&&this.detailsView.model===t.model?(this.detailsView.$el.toggle(),t.$el.toggleClass("highlighted"),this.model.get("media-collection-view").$el.toggleClass("menu-visible"),f.broadcast.trigger("toggle:insertButton")):(this.clearPreview(),this.detailsView=new u({model:t.model,el:e(".brightcove.media-frame-menu"),mediaType:this.model.get("mediaType")}),this.registerSubview(this.detailsView),this.detailsView.render(),this.detailsView.$el.toggle(!0),this.model.get("media-collection-view").$el.addClass("menu-visible"),t.$el.addClass("highlighted"),f.broadcast.trigger("toggle:insertButton","enabled"))})},clearPreview:function(){this.detailsView instanceof u&&this.detailsView.remove(),this.model.get("media-collection-view").$el.find(".highlighted").removeClass("highlighted")},startGridView:function(){this.model.set("mode","manager"),this.render()},message:function(t,n,r){var i=this.$el.find(".brightcove-message");"success"===n?(i.addClass("updated"),i.removeClass("error")):"error"===n&&(i.addClass("error"),i.removeClass("updated"));var s=e("<p>"+t+"</p>");i.append(s),i.removeClass("hidden"),r?(f.permanentMessage&&f.permanentMessage.remove(),f.permanentMessage=s):s.fadeOut(6e3,function(){e(this).remove(),i.addClass("hidden")})},showUploader:function(){"manager"===this.model.get("mode")?this.model.set("mode","uploader"):this.model.set("mode","manager"),this.render()},permanentMessage:function(e){this.message(e,"error",!0)},render:function(){var n=this.model.get("options"),r,i=this.model.get("mode");t.invoke(this.subviews,"remove");if("uploader"===i)this.template=wp.template("brightcove-uploader-container"),this.$el.empty(),this.$el.html(this.template(n)),this.uploader.render(),this.uploader.delegateEvents(),this.uploader.$el.appendTo(e(".brightcove-uploader"));else if("manager"===i){this.template=wp.template("brightcove-media"),this.$el.html(this.template(n)),this.toolbar.render(),this.toolbar.delegateEvents(),this.toolbar.$el.show(),this.toolbar.$el.appendTo(this.$el.find(".media-frame-router"));var s=this.model.get("media-collection-view");s.render(),s.delegateEvents();var o=this.$el.find(".media-frame-content");o.on("scroll",this.scrollHandler),s.$el.appendTo(o),!f.initialSync||(f.broadcast.trigger("remove:permanentMessage"),f.broadcast.trigger("permanent:message",f.preload.messages.ongoingSync))}else"editVideo"===i?(this.toolbar.$el.hide(),r=this.$el.find(".media-frame-content"),r.empty(),this.editView.render(),this.editView.delegateEvents(),this.editView.$el.appendTo(r),this.$el.find(".brightcove.media-frame-content").addClass("edit-view")):"editPlaylist"===i?(this.toolbar.$el.hide(),r=this.$el,r.empty(),r.html('<div class="playlist-edit-container"></div>'),r=r.find(".playlist-edit-container"),this.editView.render(),this.editView.delegateEvents(),this.editView.$el.appendTo(r),r.addClass("playlist")):"previewVideo"===i&&(this.toolbar.$el.hide(),r=this.$el.find(".media-frame-content"),r.empty(),this.previewView.render(),this.detailsView.render({detailsMode:"preview"}),this.previewView.delegateEvents(),this.previewView.$el.appendTo(r),this.$el.find(".brightcove.media-frame-toolbar").hide(),brightcove.createExperiences());return"editPlaylist"!==i&&this.$el.find(".media-frame-content").removeClass("playlist"),this}});return h}),define("models/brightcove-modal",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({getMediaManagerSettings:function(){var e=this.get("tab"),t={upload:{accounts:"all",date:"all",embedType:"modal",mediaType:"videos",mode:"uploader",preload:!0,search:"",tags:"all",viewType:"grid"},videos:{accounts:"all",date:"all",embedType:"modal",mediaType:"videos",mode:"manager",preload:!0,search:"",tags:"all",viewType:"grid"},playlists:{accounts:"all",date:"all",embedType:"modal",mediaType:"playlists",mode:"manager",preload:!0,search:"",tags:"all",viewType:"grid"}};return undefined!==t[e]?t[e]:!1}});return r}),define("views/brightcove-modal",["jquery","underscore","backbone","views/brightcove-media-manager","views/video-preview","models/brightcove-modal","views/brightcove"],function(e,t,n,r,i,s,o){var u=o.extend({tagName:"div",className:"media-modal brightcove",template:wp.template("brightcove-media-modal"),events:{"click .brightcove.media-menu-item":"changeTab","click .brightcove.media-button-insert":"insertIntoPost","click .brightcove.media-modal-close":"closeModal"},initialize:function(e){this.model=new s({tab:e.tab}),this.brightcoveMediaManager=new r(this.model.getMediaManagerSettings()),this.registerSubview(this.brightcoveMediaManager),this.listenTo(wpbc.broadcast,"toggle:insertButton",function(e){this.toggleInsertButton(e)}),this.listenTo(wpbc.broadcast,"close:modal",this.closeModal)},insertIntoPost:function(){wpbc.broadcast.trigger("insert:shortcode")},toggleInsertButton:function(e){var t=this.$el.find(".brightcove.media-button");"enabled"===e?t.removeAttr("disabled"):"disabled"===e?t.attr("disabled","disabled"):undefined!==t.attr("disabled")?t.removeAttr("disabled"):t.attr("disabled","disabled")},changeTab:function(n){if(e(n.target).hasClass("active"))return;e(n.target).addClass("active");var r=t.without(n.target.classList,"media-menu-item","brightcove")[0],i=["videos","upload","playlists"];t.each(t.without(i,r),function(t){e(".brightcove.media-menu-item."+t).removeClass("active")}),t.contains(i,r)&&(this.model.set("tab",r),wpbc.broadcast.trigger("spinner:off"),wpbc.broadcast.trigger("tabChange",this.model.getMediaManagerSettings()))},closeModal:function(){this.$el.hide()},message:function(e){var t=this.$el.find(".brightcove-message")},render:function(e){this.$el.html(this.template(e)),this.brightcoveMediaManager.render(),this.brightcoveMediaManager.$el.appendTo(this.$el.find(".media-frame-content"))}});return u}),define("app",["jquery","underscore","backbone","wpbc","views/brightcove-media-manager","views/brightcove-modal","wp"],function(e,t,n,r,i,s,o){var u={renderMediaManager:function(t){var n=e(".brightcove-media-"+t),r=document.getElementById("content_ifr");if(n.length){var s=new i({el:n,date:"all",embedType:"page",preload:!0,mode:"manager",search:"",accounts:"all",tags:"all",mediaType:t,viewType:"grid"});s.render()}},load:function(){r.requests=[],r.responses={},r.broadcast=t.extend({},n.Events),r.selfSync=function(){e.get(ajaxurl,{action:"bc_initial_sync"},function(e){e.success?r.broadcast.trigger("remove:permanentMessage"):t.delay(r.selfSync,1e4)})},!r.initialSync||r.selfSync(),e(window).load(this.loaded),window.location.href.indexOf("page-brightcove")&&t.delay(t.bind(function(){r.triggerModal||this.loaded()},this),100)},loaded:function(){var n=e(".brightcove-modal");r.triggerModal=function(){r.modal?r.modal.$el.show():(r.modal=new s({el:n,tab:"videos"}),r.modal.render())};var i=function(e){return e.replace(/\D/g,"")};t.each(["videos","playlists"],function(e){u.renderMediaManager(e)}),e(".account-toggle-button").on("click",function(t){t.preventDefault(),e(this).hide(),e(".brightcove-account-row.hidden").show()}),e(".brightcove-add-new-video").on("click",function(e){e.preventDefault(),r.broadcast.trigger("upload:video")}),e(".brightcove-add-media").on("click",function(){r.triggerModal()}),e(document).keyup(function(e){27===e.keyCode&&r.broadcast.trigger("close:modal")}),e("a.brightcove-action-delete-source").on("click",function(t){var n=e(this).data("alert-message");if(!confirm(n))return!1})}};return u}),requirejs.config({baseUrl:wpbc.path}),typeof jQuery=="function"&&define("jquery",function(){return jQuery}),typeof _=="function"&&define("underscore",function(){return _}),typeof Backbone=="object"&&define("backbone",function(){return Backbone}),typeof wp=="object"&&define("wp",function(){return wp}),typeof wpbc=="object"&&define("wpbc",function(){return wpbc}),typeof plupload=="object"&&define("plupload",function(){return plupload}),requirejs(["app"],function(e){e.load()}),define("setup",function(){});